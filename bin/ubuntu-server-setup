#!/bin/bash

is_running_ubuntu() {
    version="$(cat /etc/issue 2> /dev/null)"
    if [[ $version == *"Ubuntu"* ]]; then
        echo true
    else
        echo false
    fi
}

is_executable() {
    if command -v "$1" &> /dev/null; then
        echo true
    else
        echo false
    fi
}

if [[ $(is_running_ubuntu) == true ]]; then 
    apt update
    apt -y upgrade

    if [[ $(is_executable "make") == false ]]; then 
        apt -y install make
    fi
    if [[ $(is_executable "pip3") == false ]]; then 
        apt -y install python3-pip
    fi
fi

if [ ! -d ../venv/ ]; then
    pip3 install virtualenv
    python3 -m virtualenv ../venv/
    ../venv/bin/pip3 install -r ../requirements.txt
fi

cd ../ && make -s all
